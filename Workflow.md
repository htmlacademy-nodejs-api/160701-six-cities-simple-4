# Как работать над проектом

## Окружение

Для удобства работы над проектом используются инструменты из **Node.js** и **npm**. Все необходимые настройки произведены. Убедитесь, что на рабочем компьютере установлен актуальный LTS релиз Node.js**. Актуальная версия **Node.js\*\* указана в файле `package.json` в поле `node`. Затем, в терминале, перейдите в директорию с проектом и _единожды_ запустите команду:

```bash
npm install
```

Команда запустит процесс установки зависимостей проекта из **npm**.

### Сценарии

В `package.json` предопределено несколько сценариев.

#### Скомпилировать проект

```bash
npm run compile
```

Создаст директорию `dist` и скомпилирует проект.

#### Удалить скомпилированный проект

```bash
npm run clean
```

Удаляет директорию `dist`. Используется перед компиляцией.

#### Собрать проект

```bash
npm run build
```

Выполняет сборку проекта: удаляет ранее скомпилированный проект и компилирует заново.

#### Проверить линтером

```bash
npm run lint
```

Запуск проверки проекта статическим анализатором кода **ESLint**.

Линтер проверяет файлы только внутри директории `src`.

**Обратите внимание**, при запуске данной команды, ошибки выводятся в терминал.

#### Запустить ts-модуль без компиляции

```bash
npm run ts -- <Путь к модулю с ts-кодом>
```

Пакет `ts-node` позволяет выполнить TS-код в Node.js без предварительной компиляции. Используется только на этапе разработки.

#### Запустить JSON-сервер

```bash
npm run mock:server
```

Запускает веб-сервер для получения моковых данных из JSON.

#### Запустить проект

```bash
npm start
```

В процессе запуска проекта будет выполнен процесс «Сборки проекта» и запуск результирующего кода.

#### Запустить проект в dev-режиме

```bash
npm run start:dev
```

Запускает проект без компиляции и с красивым выводом логов. При изменении в директории `src` проект перезапускается с
помощью `nodemon`.

#### Запустить cli-команду

```bash
npm run cli -- --<command> [--arguments]
```

Поcле сборки проекта (`npm run build`) позволяет запустить одну из команд cli:

- `--version` - вывод номера версии
- `--help` - вывод текста помощи
- `--import <path>` - импортирует данные из TSV-файла (нужно предварительно его сгенерировать с помощью команды --generate)
- `--generate <n> <path> <url>` - генерирует моковые данные (нужно предварительно запустить сервер с моковым json
  `npm run mock:server`)

Примеры использования:

```bash
npm run ts ./src/main.cli.ts -- --import ./mocks/mock-data.tsv admin test 127.0.0.1 six-cities-simple secret
```

```bash
npm run mock:server & npm run ts ./src/main.cli.ts -- --generate 10 ./mocks/my-data.tsv http://127.0.0.1:3123/api
```

### Переменные окружения

Настройки, необходимые для запуска и работы сервиса, передаются с помощью переменных окружения.
Создайте в корне проекта файл `.env` или передайте их другим способом.

Необходимые переменные окружения:

| Переменная       | Пример значения | Для чего                                |
| ---------------- | --------------- | --------------------------------------- |
| PORT             | 5000            | Порт для входящих подключений           |
| SALT             | 123             | Соль для хеширования паролей            |
| DB_HOST          | 127.0.0.1       | IP-адрес сервера БД (MongoDB)           |
| DB_USER          | admin           | Имя пользователя для соединения с БД    |
| DB_PASSWORD      | test            | Пароль пользователя для соединения с БД |
| DB_PORT          | 27017           | Порт БД (MongoDB)                       |
| DB_NAME          | six_sities      | Название БД (MongoDB)                   |
| UPLOAD_DIRECTORY | upload          | Директория для сохранения файлов        |
| STATIC_DIRECTORY | static          | Директория для статических файлов       |
| JWT_SECRET       | secret_jwt      | Секрет для создания JWT токена          |
| HOST             | localhost       | Имя хоста для запуска приложения        |

[Подробнее](src/core/config/rest.schema.ts)

## Структура проекта

### Директория `src`

Исходный код проекта: компоненты, модули и так далее. Структура директории `src` может быть произвольной.

### Файл `Readme.md`

Инструкции по работе с учебным репозиторием.

### Файл `Contributing.md`

Советы и инструкции по внесению изменений в учебный репозиторий.

### Остальное

Все остальные файлы в проекте являются служебными. Пожалуйста, не удаляйте и не изменяйте их самовольно. Только если того требует задание или наставник.

## Запуск проекта

1. Установите зависимости:

```bash
npm install
```

2. Добавьте в корень проекта файл `.env` и задайте в нем переменные окружения.
3. Соберите проект:

```bash
npm run build
```

4. Запустите мок-сервер:

```bash
npm run mock:server
```

5. Сгенерируйте файл `.tsv` с тестовыми данными:

```bash
npm run ts ./src/main.cli.ts -- --generate 10 ./mocks/my-data.tsv http://127.0.0.1:3123/api
```

6. Поднимите докер с БД:

```bash
docker-compose up
```

7. Переложите тестовые данные из файла `.tsv` в БД:

```bash
npm run ts ./src/main.cli.ts -- --import ./mocks/mock-data.tsv admin test 127.0.0.1 six-cities-simple secret
```

8. Запустите проект в dev-режиме:

```bash
npm run start:dev
```
